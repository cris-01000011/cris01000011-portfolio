---
import CrossIcon from "../../src/assets/svgs/cross-small-svgrepo-com.svg"
const { id, title, width="w-[calc(100%-40px)]", height="h-[90%]" } = Astro.props;
---

<dialog id={id} class={`fixed bottom-16 ${width} ${height} left-5 bg-inherit`}>
  <div class="animate-fade absolute w-full h-full bg-white/40 border border-black/5 backdrop-blur-[5px] shadow-md rounded-xl overflow-hidden">
    <div id={"PopupBrave2"} class="header relative flex items-center justify-end px-2 w-full h-[25px] bg-black/5 rounded-t-xl cursor-move">
      <span class="absolute top-0 left-0 text-black/50 px-2">{title}</span>
      <form method="dialog">
        <button type="submit" class="flex items-center">
          <CrossIcon width={20} height={20} />
        </button>
      </form>
    </div>

    <slot />

    <!-- BotÃ³n de esquina inferior derecha -->
    <div class="resize-handle absolute bottom-0 right-0 w-4 h-4 cursor-se-resize"></div>
  </div>
</dialog>

<style>
  @keyframes fade {
    from {
      opacity: 0;
      transform: translateY(50px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade {
    animation: fade 0.25s linear;
  }

  dialog::backdrop {
    background: transparent;
  }
</style>

<script>
  const dialogs = document.getElementsByTagName("dialog");

  Array.from(dialogs).forEach((dialog) => {
    const header = dialog.querySelector<HTMLElement>(".header");
    const resizeHandle = dialog.querySelector<HTMLElement>(".resize-handle");

    if (header) dragElement(dialog as HTMLDialogElement, header);
    if (resizeHandle) makeResizable(dialog as HTMLDialogElement, resizeHandle);
  });

  function dragElement(elmnt: HTMLDialogElement, handle: HTMLElement) {
    let pos1 = 0,
      pos2 = 0,
      pos3 = 0,
      pos4 = 0;

    handle.onmousedown = (e) => {
      e.preventDefault();
      pos3 = e.clientX;
      pos4 = e.clientY;
      document.onmouseup = closeDragElement;
      document.onmousemove = elementDrag;
    };

    function elementDrag(e: MouseEvent) {
      e.preventDefault();
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
      elmnt.style.top = elmnt.offsetTop - pos2 + "px";
      elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
    }

    function closeDragElement() {
      document.onmouseup = null;
      document.onmousemove = null;
    }
  }

  function makeResizable(elmnt: HTMLDialogElement, handle: HTMLElement) {
    let startX = 0, startY = 0, startWidth = 0, startHeight = 0;

    handle.addEventListener("mousedown", initResize);

    function initResize(e: MouseEvent) {
      e.preventDefault();
      startX = e.clientX;
      startY = e.clientY;
      startWidth = parseInt(document.defaultView?.getComputedStyle(elmnt).width || "0", 10);
      startHeight = parseInt(document.defaultView?.getComputedStyle(elmnt).height || "0", 10);
      document.addEventListener("mousemove", resizeDialog);
      document.addEventListener("mouseup", stopResize);
    }

    function resizeDialog(e: MouseEvent) {
      elmnt.style.width = startWidth + (e.clientX - startX) + "px";
      elmnt.style.height = startHeight + (e.clientY - startY) + "px";
    }

    function stopResize() {
      document.removeEventListener("mousemove", resizeDialog);
      document.removeEventListener("mouseup", stopResize);
    }
  }
</script>
